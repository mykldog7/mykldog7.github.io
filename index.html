<!DOCTYPE html>
<html>
<head>
<title>JS NeuralNet Digit Classifier</title>

<!-- Metadata -->
<meta charset="UTF-8">

<!-- Scripts -->
<script src="lib/jquery-2.1.4.min.js"></script> 
<script src="lib/bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
<script src="processFile.js"></script>
<script src="makeCanvas.js"></script>
<script src="jsNN.js"></script>
<script src="featureSetup.js"></script>
<script src="hiddenLayerSetup.js"></script>
<script src="outputLayers.js"></script>
<script src="utils.js"></script>
<script src="nntrain.js"></script>

<!-- CSS -->
<link href="lib/bootstrap-3.3.5-dist/css/bootstrap.min.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">

<!-- Scripts -->
<script>
//GLOBALS
//storage for images and labels. used by jsNN.js so that the network can access the images. 
var imgArr = [];
var lblArray = [];
//This global is the weights and feature locations. It should be saveable. 
var NeuralNetwork;

/*Grabs the values from the fields and makes a data object and then calls the method in processFile.js*/
function callLoadImagesFromFile(){
	//Construct data object with configuration parameters and file data. 
	var data = {};
	data.file = document.getElementById('imageFileSelector').files[0];
	data.initOffset = +document.getElementById('img-bytes-before').value;
	data.imageCount = +document.getElementById('img-count').value;
	data.imageWidth = +document.getElementById('img-dim-width').value;
	data.imageHeight = +document.getElementById('img-dim-height').value;
	data.imageSpacing = +document.getElementById('img-bytes-between').value;
	
	//in processFile.js
	LoadImagesFromFile(data, function(imgArray){
		console.log("Image array from File:" + imgArray);
		imgArr=imgArray;
		//prepare element and params for the images generating function.
		var imagesHolderElem = document.getElementById('imageHolder');
		var params = {width: data.imageWidth, height: data.imageHeight};
		makeCanvasElements(imagesHolderElem, imgArray, params);
	});
}

/*Grab the labels from the label file and then place on top of canvas elements.*/
function callLoadLabelsFromFile(){
	var data = {};
	data.file = document.getElementById('labelFileSelector').files[0];
	data.initOffset = +document.getElementById('label-bytes-before').value;
	data.spaceBetweenLabels = +document.getElementById('label-bytes-between').value;
	data.labelCount = +document.getElementById('img-count').value;		//same count as images.. makes sense right?
	
	//in processFile.js
	LoadLabelsFromFile(data, function(lblArrayLocal){
		console.log("Labels from file:" + lblArrayLocal);
		lblArray = lblArrayLocal;
		//prepare element and params for the images generating function.
		var imagesHolderElem = document.getElementById('imageHolder');
		addLablesToCanvases(imagesHolderElem, lblArrayLocal);
	});
}

/*Grabs the values and sets up the network..*/
function constructNetwork(){
	var params = 	{	width: +document.getElementById('img-dim-width').value, 
						height: +document.getElementById('img-dim-height').value
					};
	//in jsNN.js
	initNetwork(	params,
					+document.getElementById('nn-features').value,
					+document.getElementById('nn-hidden-layer-count').value,
					+document.getElementById('nn-hidden-layer-size').value,
					+document.getElementById('nn-learning-rate').value
				); 	
}

/*Trains a network.. using methods in jsNN.js*/
function callTrainNetwork(){
	//This will later be the partition point once user has selected training set. 
	var imagesToTrainWithArray = imgArr;
	trainNetwork(imagesToTrainWithArray);
}
</script>

</head>
<body>
<!-- Navbar -->
<div class="navbar navbar-default navbar-static-top">
	<div class="container-fluid">
		<div class="navbar-header">
			<a class="navbar-brand nav-top-padding" href="#">
				<img src="img/brand_o.png" alt="JavaScript Neural Network" height="30" width="68">
			</a>
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#top-navbar" aria-expanded="false">
				<span class="sr-only">Toggle</span>
				<span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
			</button>
		</div>
		<div class="collapse navbar-collapse" id="top-navbar">
			<ul class="nav navbar-nav navbar-right">
				<li><a href="#">Home</a></li>
				<li><a href="#">About</a></li>
				<li><a href="#">Hire Me</a></li>
			</ul>
		</div>
	</div>
</div>

<!-- Content -->
<div class="container">
	<div class="row">
		<div class="col-sm-10"><h2 style="margin-top: 0px;">JavaScript Neural Network Digit Recognizer</h2></div>
	</div>
	<div class="row">
		<div class="col-sm-6 col-md-4 col-lg-4">
			<div class="page-element">
				<h2>Load Image/Label Files...</h2>
				<div>
					Image file options:<br>
					Offset to first image:<input class="numberinputs" type="number" id="img-bytes-before" value="16" /><br>
					Image Dimensions:<br> 
					Width:<input class="numberinputs" type="number" id="img-dim-width" value="28" />&nbsp;
					Height:<input class="numberinputs" type="number" id="img-dim-height" value="28" /><br>
					Bytes between images:<input class="numberinputs" type="number" id="img-bytes-between" value="0" /><br>
					Image count:<input class="numberinputs" type="number" id="img-count" value="4" /><br>
					Specify file:
					<input type="file" id="imageFileSelector" />
					<button type="button" class="clickbutton" onclick="callLoadImagesFromFile()">Load Images</button><br><br>
					Label file options:<br>
					Offset to first label:<input class="numberinputs" type="number" id="label-bytes-before" value="8" /><br>
					Bytes between labels:<input class="numberinputs" type="number" id="label-bytes-between" value="0" /><br>
					<input type="file" id="labelFileSelector" />
					<button type="button" class="clickbutton" onclick="callLoadLabelsFromFile()">Load Labels</button>
				</div>
			</div>
		</div>
		<div class="col-sm-6 col-md-4 col-lg-4">
			<div class="page-element">
				<h2>View Images...</h2>
				<div>
					<div class="row" id="imageHolder">
						<div class="image-display">&nbsp;Once loaded, images will appear here. </div>
					</div>
				</div>
			</div>
		</div>
		<div class="clearfix visible-sm"></div>
		<div class="col-sm-6 col-md-4 col-lg-4">
			<div class="page-element">
				<h2>Configure Neural Net...</h2>
				<div>Neural Net parameters<br>
					Number of Features<input class="numberinputs" type="number" id="nn-features" value="10" /><br>
					Network Architecture..<br> 
					Hidden layers:<input class="numberinputs" type="number" id="nn-hidden-layer-count" value="3" /><br>
					Nodes in each hidden layer:<input class="numberinputs" type="number" id="nn-hidden-layer-size" value="5" /><br>
					Learning Rate: <input class="numberinputs" type="number" id="nn-learning-rate" step=".1" value="0.2" /><br>
					<button type="button" class="clickbutton" onclick="constructNetwork()">Construct network</button> or 
					<button type="button" class="clickbutton" onclick="loadNetwork()">Load from file</button>
				</div>
			</div>
		</div>
		<div class="clearfix visible-md visible-lg"></div>
		<div class="col-sm-6 col-md-4 col-lg-4">
			<div class="page-element">
				<h2>Train Network...</h2>
				<div>Partition Images<br>
					Percentage for training:<input class="numberinputs" type="number" id="dataset-training-percent" value="100" /><br>
					Training parameters<br>
					Error percentage:<input class="numberinputs" type="number" id="nn-stop-error" value="0" /><br>
					Training cycles:<input class="numberinputs" type="number" id="nn-stop-cycles" value="4" /><br>
					<button type="button" class="clickbutton" onclick="callTrainNetwork()">Train network</button>
				</div>
			</div>
		</div>
	</div>
	
</div>

<!-- Footer -->
<div><br><hr>&nbsp; Developed by Michael Riley - 2015</div>

</body>
</html>
